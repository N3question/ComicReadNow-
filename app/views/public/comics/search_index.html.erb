<div class="container" style="margin-top:100px;">
  <div class="row mx-auto" style="padding:30px 0px 45px;">
      
        <div class="mx-auto">
            <%= link_to root_path, class:"btn btn-sm mb-4 px-3 border", style:"color:#00264D;" do %>
              <i class="bi bi-arrow-left"></i>
            <% end %>
            
            <h5 class="mb-5"><b>'<%= params[:keyword] %>'の検索結果</b></h5>
            <div class="d-inline-flex flex-wrap" style="justify-content:center;">
                <% @rakuten_web_services.each do |book| %>
                <% comic = Comic.find_by(isbn: book["isbn"]) %>
                    <div class="mx-2">
                      <div style="width:150px;">
                        <% if comic %>
                            <%= link_to comic_path(id: comic.id, keyword: params[:keyword],page: @current_page), class:"img_link" do %>
                              <%= image_tag book["largeImageUrl"], style:"width:150px; height:230px; background-size: cover; border:0.5px solid #00264D; box-shadow:8px 8px 20px #999;" %>
                            <% end %>
                        <% else %>
                            <%= image_tag book["largeImageUrl"], style:"width:150px; height:230px; background-size: cover; border:0.5px solid #00264D; box-shadow:8px 8px 20px #999;" %>
                        <% end %>
                      </div>
                      <div class="py-4 mb-3" style="width:150px; height:auto;">
                        <% if comic %>
                            <%= link_to comic_path(comic.id) do %>
                              <p class="mb-2" style="height:50px;"><b><%= book["title"].truncate(20) %></b></p>
                            <% end %>
                        <% else %>
                            <p class="mb-2" style="height:50px;"><b><%= book["title"].truncate(20) %></b></p>
                        <% end %>
                        <% if user_signed_in? && !comic %>
                            <div class= "sample mb-2 d-flex" style="justify-content: flex-end;">
                                <input type="button" class="btn btn-sm btn-outline-dark mb-2 px-3 text-nowrap w-100" style="" value="サイト情報追加">
                            </div>
                            <div class= "sampleA p-2 border" style="height:270px; width:100%; display:flex; justify-content:center;">
                                <div class="p-3">
                                  <%= flash[:alert] %>
                                  <small style="color:red;">※ 読むことができるサイトを全て選択</small>
                                  
                                  <div class="mt-4">
                                      <%= form_with model: @comic, url: comics_path, method: :post do |f| %>
                                          <%= f.hidden_field :isbn, value: params[:isbn] %>
                                          <% Site.all.each do |site| %>
                                              <%= f.check_box :site_ids,{ multiple: true, checked: site[:checked],disabled: site[:disabled], include_hidden: false }, site[:id] %>
                                              <%= f.label site.name, for:"comic_site_ids_#{site[:id]}" %>　
                                          <% end %><br>
                                          <%= f.submit "漫画情報追加", class:"btn rounded-pill mt-3 w-100", style:"background-color:#66CC00; color:white;" %>
                                      <% end %>
                                  </div>
                                </div>
                            </div>
                            <script src="index.js"></script>
                        <% end %>
                      </div>
                    </div>
                <% end %>
            </div>
            
            <div class="d-flex flex-wrap" style="justify-content:center;">
                <%= paginate @rakuten_web_services %>
            </div>
        </div>
        
  </div>
</div>

<span id="back" style="width:100%; display:none;">
  <a href=""  style="text-decoration:none;">
      <div class="d-flex justify-content-center border mt-5 mb-4 mx-auto" 
           style="width:95%; height:60px; line-height:60px; background-color:#FFF; box-shadow:5px 5px 5px #DDD;">
        <p class="mb-0 text-dark">TOPへ戻る<i class="bi bi-arrow-up"></i></p>
      </div>
  </a>
</span>

<script>
  $(function(){
    // ウィンドウの高さとmain要素の高さを取得
    var windowHeight = $(window).height();
    var mainHeight = $('main').height();

    // main要素の高さがウィンドウの高さより大きい場合
    if(mainHeight > windowHeight) {
        // 特定の要素を表示
        $('#back').show();
    } else {
        // そうでない場合、要素を非表示
        $('#back').hide();
    }
  })
    
  $(function(){
    //ボタンのイベント
    $(".btn").click(function(){
      // sampleAクラスをスライドアップ/ダウンさせる
      $(".sampleA").slideToggle();
    });
  });
</script>